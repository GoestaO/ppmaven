<ui:composition template="templates/base_content.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:mc="http://xmlns.jcp.org/jsf/composite/myComponent"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">


    <ui:define name="content">

        <h:form rendered ="#{!userBean.valid}">
            <p:button href="login.jsf" value="Zum Login" />
            <p:button href="register.jsf" value="Zur Registrierung" />
            <p:messages id="message" showDetail="true"/>
            #{overviewController.fatal()}
        </h:form>

        <h:form id="form">
            <p:hotkey bind="alt+n" handler="varEditButton.jq.click()" />
            <p:growl id="msgs" showDetail="true"/>
            <p:dataTable widgetVar = "dataTable" sortMode="multiple" id="backlog" selectionMode="multiple" selection="#{overviewController.selectedArticles}" rowKey="#{article.identifier}" var="article" value="#{overviewController.backlogList}" rows="50"
                         paginator="true"
                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" currentPageReportTemplate="{startRecord}-{endRecord} von {totalRecords}"
                         rowsPerPageTemplate="10,50,100" rendered ="#{userBean.valid}" filteredValue="#{overviewController.filteredArticles}" emptyMessage="Keine Artikel gefunden" style="text-align: center;">
<!--                <p:ajax event="rowEdit" listener="#{overviewController.onRowEdit}" update=":form:msgs" />
                <p:ajax event="rowEditCancel" listener="#{overviewController.onRowCancel}" update=":form:msgs" />-->

                <p:column headerText="Config" filterBy="#{article.config}" filterMatchMode="contains">
                    <h:outputText value="#{article.config}"/>
                </p:column>
                <p:column headerText="EAN" filterBy="#{article.ean}" filterMatchMode="contains">
                    <h:outputText value="#{article.ean}"/>
                </p:column>                
                <p:column headerText="Anzahl" filterBy="#{article.counter}" filterStyle="width: 20px;">
                    <h:outputText value="#{article.counter}"/>
                </p:column>
                <p:column headerText="WG-Pfad">
                    <h:outputText value="#{article.cgPath}"/>
                </p:column>
                <p:column headerText="Partner" filterBy="#{article.partnerId}" filterMatchMode="contains" filterStyle="width: 25px;">
                    <h:outputText value="#{article.partnerId}"/>
                </p:column>
                <p:column headerText="Datum" filterBy="#{article.cgPath}" filterMatchMode="contains" filterStyle="width: 50px;">
                    <h:outputText value="#{article.datum}">
                        <f:convertDateTime dateStyle="short" locale="de" type="date" />
                    </h:outputText>
                </p:column>
                <p:column headerText="Saison" filterBy="#{article.cgPath}" filterMatchMode="contains" filterStyle="width: 35px;">
                    <h:outputText value="#{article.saison}"/>
                </p:column>
                <p:column headerText="Appdomain" filterBy="#{article.appdomainId}" filterMatchMode="contains" filterStyle="width: 20px;">
                    <h:outputText value="#{article.appdomainId}"/>
                </p:column>
                <p:column headerText="Bemerkung 1" filterBy="#{article.bemerkung1}" filterMatchMode="contains">
                    <h:outputText value="#{article.bemerkung1}" />                 
                </p:column>
                <p:column headerText="Bemerkung 2" filterBy="#{article.bemerkung2}" filterMatchMode="contains">
                    <h:outputText value="#{article.bemerkung2}"/>
                </p:column>
                <p:column headerText="Bemerkung 3" filterBy="#{article.bemerkung3}" filterMatchMode="contains">
                    <h:outputText value="#{article.bemerkung3}"/>
                </p:column>
                <p:column headerText="Bemerkung KAM" filterBy="#{article.bemerkungKAM}" filterMatchMode="contains">
                    <h:outputText value="#{article.bemerkungKAM}"/>
                </p:column>
                <p:column>
                    <p:commandButton icon="ui-icon-wrench" oncomplete ="PF('editDialog').show()" update=":form:articleDetail" >
                        <f:setPropertyActionListener target="#{overviewController.selectedArticles}" value="#{overviewController.toList(article)}"/>
                    </p:commandButton>
                </p:column>
                <f:facet name="header">                    
                    <p:commandButton id="editButton" widgetVar="varEditButton" process="backlog" update=":form:articleDetail" icon="ui-icon-search" value="Bearbeiten" oncomplete="PF('editDialog').show()" />
                </f:facet>
            </p:dataTable>

            <p:dialog header="Artikel bearbeiten" id="articleDetail" widgetVar="editDialog" modal="true">
                <p:dataTable id="dataTable" var="selectedArticle"  value="#{overviewController.selectedArticles}" editable="true" editMode="cell" style="font-size: 12px">                        
                    <p:columnGroup type="header">
                        <p:row>
                            <p:column headerText="Config"/>
                            <p:column headerText="EAN"/>
                            <p:column headerText="Appdomain"/>
                            <p:column headerText="Partner"/>
                            <p:column headerText="Bemerkung 1"/>
                            <p:column headerText="Bemerkung 2"/>
                            <p:column headerText="Bemerkung 3"/>
                            <p:column headerText="Bemerkung KAM"/>
                            <p:column headerText="Datum"/>
                            <p:column headerText="Status"/>
                        </p:row>
                    </p:columnGroup>
                    <p:column>
                        <h:outputText value="#{selectedArticle.config}" />
                    </p:column>
                    <p:column>
                        <h:outputText value="#{selectedArticle.ean}" />
                    </p:column>
                    <p:column>
                        <h:outputText value="#{selectedArticle.appdomainId}" />
                    </p:column>
                    <p:column>
                        <h:outputText value="#{selectedArticle.partnerId}" />
                    </p:column>
                    <p:column>
                        <p:inputTextarea rows="2" cols="30" value="#{selectedArticle.bemerkung1}">
                            <p:ajax/>
                        </p:inputTextarea>                        
                    </p:column>
                    <p:column>
                        <p:inputTextarea rows="2" cols="30" value="#{selectedArticle.bemerkung2}">
                            <p:ajax/>
                        </p:inputTextarea>
                    </p:column>
                    <p:column>
                        <p:inputTextarea rows="2" cols="20" value="#{selectedArticle.bemerkung3}" >
                            <p:ajax/>
                        </p:inputTextarea>
                    </p:column>
                    <p:column>
                        <p:inputTextarea rows="2" cols="30"  value="#{selectedArticle.bemerkungKAM}">
                            <p:ajax/>
                        </p:inputTextarea>
                    </p:column>
                    <p:column>
                        <h:outputText value="#{selectedArticle.datum}">
                            <f:convertDateTime dateStyle="short" locale="de" type="date" />
                        </h:outputText>
                    </p:column>
                    <p:column>
                        <p:selectOneButton value="#{selectedArticle.offen}">
                            <f:selectItem itemLabel="offen" itemValue="true"/>
                            <f:selectItem itemLabel="fertig" itemValue="false"/>                          
                            <p:ajax/>                     
                        </p:selectOneButton>
                    </p:column>            
                </p:dataTable>
                <f:facet name="footer">
                    <p:commandButton styleClass="dialogbutton" process = "@this" update=":form:backlog,msgs" value="Speichern" action="#{overviewController.update(overviewController.selectedArticles)}" oncomplete="PF('editDialog').hide()"/>
                </f:facet>
            </p:dialog>
        </h:form>

    </ui:define>



</ui:composition>