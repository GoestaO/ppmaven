<ui:composition template="templates/base_content.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:mc="http://xmlns.jcp.org/jsf/composite/myComponent"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">


    <ui:define name="content">

        <h:form rendered ="#{!userBean.valid}">
            <p:button href="login.jsf" value="Zum Login" />
            <p:button href="register.jsf" value="Zur Registrierung" />
            <!--<p:messages id="message" showDetail="true"/>-->
            #{overviewController.fatal()}
        </h:form>

        <h:form id="form">
            <p:hotkey bind="alt+n" handler="PF('varEditButton').jq.click()" />
            <p:growl id="msgs" showDetail="true"/>
            <p:dataTable widgetVar = "dataTable" id="backlog" selectionMode="multiple" selection="#{overviewController.selectedArticles}" rowKey="#{article.identifier}" var="article" value="#{overviewController.backlogList}" rows="100"
                         paginator="true" 
                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" currentPageReportTemplate="{startRecord}-{endRecord} von {totalRecords}, gefiltert von ursprünglich #{overviewController.backlogList.size()}"
                         rowsPerPageTemplate="50,100,200" rendered ="#{userBean.valid}" filteredValue="#{overviewController.filteredArticles}" emptyMessage="Keine Artikel gefunden" style="text-align: center;">
<!--                <p:ajax event="rowEdit" listener="#{overviewController.onRowEdit}" update=":form:msgs" />
                <p:ajax event="rowEditCancel" listener="#{overviewController.onRowCancel}" update=":form:msgs" />-->

                <p:column headerText="Config" filterBy="#{article.config.toLowerCase()}" width="120" filterMatchMode="contains">
                    <h:outputText value="#{article.config}"/>
                </p:column>
                <p:column headerText="EAN" filterBy="#{article.ean}" width="120" filterMatchMode="contains">
                    <h:outputText value="#{article.ean}"/>
                </p:column>                
                <p:column headerText="Anzahl" filterBy="#{article.counter}" width="40" filterStyle="width: 20px;">
                    <h:outputText value="#{article.counter}"/>
                </p:column>
                <p:column headerText="WG-Pfad" width="60">
                    <h:outputText value="#{article.cgPath}"/>
                </p:column>
                <p:column headerText="Partner" filterBy="#{article.partnerId}" filterMatchMode="contains" width="60" filterStyle="width: 25px;">
                    <h:outputText value="#{article.partnerId}"/>
                </p:column>
                <p:column headerText="Datum" filterBy="#{article.datum}" filterMatchMode="contains" width="60" filterStyle="width: 50px;">
                    <h:outputText value="#{article.datum}">
                        <f:convertDateTime dateStyle="short" locale="de" type="date" />
                    </h:outputText>
                </p:column>
                <p:column headerText="Saison" filterBy="#{article.saison.toLowerCase()}" filterMatchMode="contains" width="60" filterStyle="width: 35px;">
                    <h:outputText value="#{article.saison}"/>
                </p:column>
                <p:column headerText="Appd." filterBy="#{article.appdomainId}" filterMatchMode="contains" width="40" filterStyle="width: 20px;">
                    <h:outputText value="#{article.appdomainId}"/>
                </p:column>
                <p:column headerText="Bemerkung 1" filterBy="#{article.bemerkung1.toLowerCase()}" filterMatchMode="contains">
                    <h:outputText value="#{article.bemerkung1}" />
<!--                    <p:autoComplete id="acSimple" value="#{article.bemerkung1}" completeMethod="#{overviewController.completeBemerkung}"  var="bemerkung" itemLabel="#{bemerkung}" itemValue="#{bemerkung}" converter="bemerkungsConverter"/>-->
                </p:column>
                <p:column headerText="Bemerkung 2" filterBy="#{article.bemerkung2.toLowerCase()}" filterMatchMode="contains">
                    <h:outputText value="#{article.bemerkung2}"/>
                </p:column>
                <p:column headerText="Bemerkung 3" filterBy="#{article.bemerkung3.toLowerCase()}" filterMatchMode="contains">
                    <h:outputText value="#{article.bemerkung3}"/>
                </p:column>
                <p:column headerText="Bemerkung KAM" filterBy="#{article.bemerkungKAM.toLowerCase()}" filterMatchMode="contains">
                    <h:outputText value="#{article.bemerkungKAM}"/>
                </p:column>
                <p:column width="40">
                    <p:commandButton icon="ui-icon-wrench" oncomplete ="PF('editDialog').show()" update=":form:articleDetail" >
                        <f:setPropertyActionListener target="#{overviewController.selectedArticles}" value="#{overviewController.toList(article)}"/>
                    </p:commandButton>
                </p:column>
                <f:facet name="header">                    
                    <p:commandButton id="editButton" widgetVar="varEditButton" process="backlog" update=":form:articleDetail" icon="ui-icon-search" value="Bearbeiten" oncomplete="PF('editDialog').show()" />
                </f:facet>
            </p:dataTable>

            <p:dialog header="Artikel bearbeiten" id="articleDetail" widgetVar="editDialog" modal="true">
                <p:dataTable id="dataTable" var="selectedArticle"  value="#{overviewController.selectedArticles}" editable="true" editMode="cell" style="font-size: 12px">                     
                    <p:columnGroup type="header">
                        <p:row>
                            <p:column width="120" headerText="Config"/>
                            <p:column width="120" headerText="EAN"/>
                            <p:column width="40" headerText="Appd."/>
                            <p:column width="60" headerText="Partner"/>
                            <p:column width="60" headerText="Saison"/>
                            <p:column width="200" headerText="Bemerkung 1"/>
                            <p:column width="200" headerText="Bemerkung 2"/>
                            <p:column width="200" headerText="Bemerkung 3"/>
                            <p:column width="200" headerText="Bemerkung KAM"/>                            
                            <p:column width="60" headerText="Status"/>
                        </p:row>
                    </p:columnGroup>
                    <p:column width="120">
                        <h:outputText value="#{selectedArticle.config}" />
                    </p:column>
                    <p:column width="120">
                        <h:outputText value="#{selectedArticle.ean}" />
                    </p:column>

                    <p:column width="40">
                        <h:outputText value="#{selectedArticle.appdomainId}" />
                    </p:column>
                    <p:column>
                        <h:outputText value="#{selectedArticle.partnerId}" />
                    </p:column>
                    <p:column width="40">
                        <p:selectOneMenu value="#{selectedArticle.saison}">
                            <f:selectItems value="#{overviewController.seasons}" var="season" itemValue="#{season}" itemLabel="#{season}"/>
                            <p:ajax/>
                        </p:selectOneMenu>
                    </p:column>
                    <p:column width="200">
<!--                        <p:inputTextarea rows="2" cols="30" value="#{selectedArticle.bemerkung1}">
                            <p:ajax/>
                        </p:inputTextarea>-->
                        <p:autoComplete size="30"  value="#{selectedArticle.bemerkung1}" completeMethod="#{overviewController.completeBemerkung1}"  var="bemerkung" itemLabel="#{bemerkung}" itemValue="#{bemerkung}" immediate="false">
                            <p:ajax/>
                            <p:ajax event="itemSelect" listener="#{overviewController.handleSelectedBemerkung1}" />
                                <!--<ui:param name="selectedBemerkung" value="${bemerkung}" />-->
                            <!--<p:ajax listener="#{overviewController.handleChangedBemerkung1}" />-->
                        </p:autoComplete>
                    </p:column>
                    <p:column width="200">
                        <p:autoComplete size="30"  value="#{selectedArticle.bemerkung2}" completeMethod="#{overviewController.completeBemerkung2}"  var="bemerkung" itemLabel="#{bemerkung}" itemValue="#{bemerkung}" immediate="false">
                            <p:ajax/>
                            <p:ajax event="itemSelect" listener="#{overviewController.handleSelectedBemerkung2}" />
                                <!--<ui:param name="selectedBemerkung" value="${bemerkung}" />-->
                            <!--<p:ajax listener="#{overviewController.handleChangedBemerkung2}" />-->
                        </p:autoComplete>
<!--                        <p:inputTextarea rows="2" cols="30" value="#{selectedArticle.bemerkung2}">
                            <p:ajax/>
                        </p:inputTextarea>-->
                    </p:column>
                    <p:column>
                        <p:inputTextarea rows="2" cols="30" value="#{selectedArticle.bemerkung3}" >
                            <p:ajax/>
                        </p:inputTextarea>
                    </p:column>
                    <p:column>
                        <p:inputTextarea rows="2" cols="30"  value="#{selectedArticle.bemerkungKAM}">
                            <p:ajax/>
                        </p:inputTextarea>
<!--                        <p:autoComplete value="#{selectedArticle.bemerkungKAM}" completeMethod="#{overviewController.completeBemerkung}"   var="bemerkung" itemLabel="#{bemerkung}" itemValue="#{bemerkung}" immediate="false">
                            <p:ajax event="itemSelect" listener="#{overviewController.handleSelectedBemerkungKAM}"  process="@form" update=":form:msgs">
                                <f:setPropertyActionListener target="#{overviewController.selectedArticle}" value="#{selectedArticle}"/>
                            </p:ajax>
                        </p:autoComplete>-->
                    </p:column>

                    <p:column width="60">
                        <p:selectOneButton value="#{selectedArticle.offen}">
                            <f:selectItem itemLabel="offen" itemValue="true"/>
                            <f:selectItem itemLabel="fertig" itemValue="false"/>                          
                            <p:ajax/>                     
                        </p:selectOneButton>
                    </p:column>            
                </p:dataTable>
                <f:facet name="footer">
                    <p:commandButton styleClass="dialogbutton" process = "@this" update=":form:backlog,msgs" value="Speichern" action="#{overviewController.update(overviewController.selectedArticles)}" oncomplete="PF('editDialog').hide()">
                        <p:confirm header="Bestätigung" message="Bist du dir sicher?" icon="ui-icon-alert" />
                    </p:commandButton>

                    <p:confirmDialog global="true">
                        <p:commandButton value="Ja" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                        <p:commandButton value="Nein" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                    </p:confirmDialog>
                </f:facet>
            </p:dialog>
        </h:form>

        <!--        <script type="text/javascript">
                    $().ready(function() {
                        if ($('div').hasClass('ui-state-active')){
                            alert("Hallo");
                        }
        
                    });
        
                </script>-->

    </ui:define>



</ui:composition>